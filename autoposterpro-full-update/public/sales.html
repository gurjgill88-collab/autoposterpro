<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sales Dashboard | AutoPosterPro</title>
  <style>
    :root {
      --purple: #7c3aed;
      --purple-dark: #6d28d9;
      --orange: #f97316;
      --green: #22c55e;
      --red: #ef4444;
      --blue: #3b82f6;
      --yellow: #eab308;
      --bg: #0f0a1a;
      --card: #1a1425;
      --card-hover: #221a30;
      --text: #fff;
      --text-dim: #a1a1aa;
      --border: #2d2640;
    }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
    }
    
    /* Layout */
    .app-container { display: flex; min-height: 100vh; }
    
    /* Sidebar */
    .sidebar {
      width: 260px;
      background: var(--card);
      border-right: 1px solid var(--border);
      padding: 20px 0;
      position: fixed;
      height: 100vh;
      overflow-y: auto;
    }
    .logo {
      font-size: 22px;
      font-weight: 800;
      padding: 0 20px 20px;
      border-bottom: 1px solid var(--border);
    }
    .logo span { color: var(--orange); }
    .user-info {
      padding: 20px;
      border-bottom: 1px solid var(--border);
    }
    .user-info .name { font-weight: 600; }
    .user-info .role { font-size: 12px; color: var(--text-dim); }
    
    .nav-section { padding: 15px 0; }
    .nav-section-title {
      font-size: 11px;
      color: var(--text-dim);
      text-transform: uppercase;
      letter-spacing: 1px;
      padding: 0 20px 10px;
    }
    .nav-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px 20px;
      color: var(--text-dim);
      text-decoration: none;
      cursor: pointer;
      transition: all 0.2s;
    }
    .nav-item:hover { background: var(--card-hover); color: var(--text); }
    .nav-item.active { background: rgba(124, 58, 237, 0.2); color: var(--purple); border-right: 3px solid var(--purple); }
    .nav-item .icon { font-size: 18px; }
    .nav-item .badge {
      margin-left: auto;
      background: var(--orange);
      color: white;
      font-size: 11px;
      padding: 2px 8px;
      border-radius: 10px;
    }
    
    /* Main Content */
    .main-content {
      margin-left: 260px;
      flex: 1;
      padding: 30px;
    }
    
    .page-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 30px;
    }
    .page-header h1 { font-size: 28px; }
    
    /* Stats Cards */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 20px;
      margin-bottom: 30px;
    }
    .stat-card {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 20px;
    }
    .stat-card .label { color: var(--text-dim); font-size: 13px; margin-bottom: 8px; }
    .stat-card .value { font-size: 32px; font-weight: 700; }
    .stat-card .change { font-size: 12px; margin-top: 8px; }
    .stat-card .change.up { color: var(--green); }
    .stat-card .change.down { color: var(--red); }
    
    /* Buttons */
    .btn {
      padding: 10px 20px;
      border: none;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }
    .btn-primary { background: var(--purple); color: white; }
    .btn-primary:hover { background: var(--purple-dark); }
    .btn-success { background: var(--green); color: white; }
    .btn-orange { background: var(--orange); color: white; }
    .btn-outline { background: transparent; border: 1px solid var(--border); color: var(--text); }
    .btn-outline:hover { border-color: var(--purple); color: var(--purple); }
    .btn-sm { padding: 6px 12px; font-size: 12px; }
    .btn-icon { padding: 8px; }
    
    /* Tables */
    .table-container {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 16px;
      overflow: hidden;
    }
    .table-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 20px;
      border-bottom: 1px solid var(--border);
    }
    .table-header h3 { font-size: 18px; }
    .table-actions { display: flex; gap: 10px; }
    
    table { width: 100%; border-collapse: collapse; }
    th, td { padding: 14px 20px; text-align: left; }
    th { 
      background: rgba(124, 58, 237, 0.1); 
      font-size: 12px; 
      text-transform: uppercase; 
      letter-spacing: 0.5px;
      color: var(--text-dim);
    }
    tr { border-bottom: 1px solid var(--border); }
    tr:hover { background: var(--card-hover); }
    tr:last-child { border-bottom: none; }
    
    /* Status Badges */
    .status {
      display: inline-block;
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
    }
    .status-new { background: rgba(59, 130, 246, 0.2); color: var(--blue); }
    .status-contacted { background: rgba(124, 58, 237, 0.2); color: var(--purple); }
    .status-qualified { background: rgba(234, 179, 8, 0.2); color: var(--yellow); }
    .status-demo { background: rgba(249, 115, 22, 0.2); color: var(--orange); }
    .status-proposal { background: rgba(236, 72, 153, 0.2); color: #ec4899; }
    .status-won { background: rgba(34, 197, 94, 0.2); color: var(--green); }
    .status-lost { background: rgba(239, 68, 68, 0.2); color: var(--red); }
    
    /* Priority */
    .priority { display: flex; align-items: center; gap: 6px; }
    .priority-dot { width: 8px; height: 8px; border-radius: 50%; }
    .priority-hot { background: var(--red); }
    .priority-warm { background: var(--orange); }
    .priority-cold { background: var(--blue); }
    
    /* Email Status */
    .email-status { display: flex; align-items: center; gap: 6px; font-size: 12px; }
    .email-status.opened { color: var(--green); }
    .email-status.sent { color: var(--text-dim); }
    .email-status.clicked { color: var(--purple); }
    
    /* Panels */
    .panel { display: none; }
    .panel.active { display: block; }
    
    /* Lead Detail Drawer */
    .drawer-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.7);
      z-index: 100;
    }
    .drawer-overlay.open { display: block; }
    .drawer {
      position: fixed;
      top: 0;
      right: -500px;
      width: 500px;
      height: 100vh;
      background: var(--card);
      z-index: 101;
      transition: right 0.3s;
      overflow-y: auto;
    }
    .drawer-overlay.open .drawer { right: 0; }
    .drawer-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 20px;
      border-bottom: 1px solid var(--border);
      position: sticky;
      top: 0;
      background: var(--card);
    }
    .drawer-close {
      background: none;
      border: none;
      color: var(--text-dim);
      font-size: 24px;
      cursor: pointer;
    }
    .drawer-body { padding: 20px; }
    
    /* Lead Detail Sections */
    .lead-header {
      text-align: center;
      padding-bottom: 20px;
      border-bottom: 1px solid var(--border);
      margin-bottom: 20px;
    }
    .lead-avatar {
      width: 80px;
      height: 80px;
      background: linear-gradient(135deg, var(--purple), var(--orange));
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 32px;
      margin: 0 auto 15px;
    }
    .lead-name { font-size: 24px; font-weight: 700; margin-bottom: 5px; }
    .lead-company { color: var(--text-dim); margin-bottom: 15px; }
    
    .detail-section {
      margin-bottom: 25px;
    }
    .detail-section h4 {
      font-size: 13px;
      text-transform: uppercase;
      color: var(--text-dim);
      letter-spacing: 0.5px;
      margin-bottom: 12px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .detail-row {
      display: flex;
      justify-content: space-between;
      padding: 10px 0;
      border-bottom: 1px solid var(--border);
      font-size: 14px;
    }
    .detail-row:last-child { border-bottom: none; }
    .detail-label { color: var(--text-dim); }
    
    /* Notes */
    .notes-list { max-height: 200px; overflow-y: auto; }
    .note-item {
      background: var(--bg);
      border-radius: 8px;
      padding: 12px;
      margin-bottom: 10px;
    }
    .note-header {
      display: flex;
      justify-content: space-between;
      margin-bottom: 8px;
      font-size: 12px;
      color: var(--text-dim);
    }
    .note-text { font-size: 14px; line-height: 1.5; }
    .note-input {
      width: 100%;
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 12px;
      color: var(--text);
      font-size: 14px;
      resize: vertical;
      min-height: 80px;
    }
    .note-input:focus { outline: none; border-color: var(--purple); }
    
    /* Activity Timeline */
    .timeline { position: relative; padding-left: 25px; }
    .timeline::before {
      content: '';
      position: absolute;
      left: 8px;
      top: 0;
      bottom: 0;
      width: 2px;
      background: var(--border);
    }
    .timeline-item {
      position: relative;
      padding-bottom: 20px;
    }
    .timeline-item::before {
      content: '';
      position: absolute;
      left: -21px;
      top: 5px;
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background: var(--purple);
      border: 2px solid var(--card);
    }
    .timeline-item.email::before { background: var(--blue); }
    .timeline-item.note::before { background: var(--orange); }
    .timeline-item.status::before { background: var(--green); }
    .timeline-time { font-size: 11px; color: var(--text-dim); margin-bottom: 4px; }
    .timeline-content { font-size: 14px; }
    
    /* Modal */
    .modal-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.8);
      z-index: 200;
      align-items: center;
      justify-content: center;
    }
    .modal-overlay.open { display: flex; }
    .modal {
      background: var(--card);
      border-radius: 16px;
      width: 100%;
      max-width: 600px;
      max-height: 90vh;
      overflow-y: auto;
    }
    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 20px;
      border-bottom: 1px solid var(--border);
    }
    .modal-header h3 { font-size: 20px; }
    .modal-close {
      background: none;
      border: none;
      color: var(--text-dim);
      font-size: 24px;
      cursor: pointer;
    }
    .modal-body { padding: 20px; }
    .modal-footer {
      padding: 20px;
      border-top: 1px solid var(--border);
      display: flex;
      justify-content: flex-end;
      gap: 10px;
    }
    
    /* Form */
    .form-group { margin-bottom: 18px; }
    .form-group label {
      display: block;
      font-size: 13px;
      color: var(--text-dim);
      margin-bottom: 6px;
    }
    .form-group input,
    .form-group select,
    .form-group textarea {
      width: 100%;
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 12px;
      color: var(--text);
      font-size: 14px;
    }
    .form-group input:focus,
    .form-group select:focus,
    .form-group textarea:focus {
      outline: none;
      border-color: var(--purple);
    }
    .form-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 15px;
    }
    
    /* Email Composer */
    .email-composer { background: var(--bg); border-radius: 12px; padding: 20px; }
    .email-field { margin-bottom: 15px; }
    .email-field label { font-size: 12px; color: var(--text-dim); display: block; margin-bottom: 5px; }
    .email-field input {
      width: 100%;
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 6px;
      padding: 10px;
      color: var(--text);
    }
    .email-body {
      width: 100%;
      min-height: 200px;
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 6px;
      padding: 12px;
      color: var(--text);
      font-size: 14px;
      resize: vertical;
    }
    .template-selector {
      display: flex;
      gap: 8px;
      margin-bottom: 15px;
      flex-wrap: wrap;
    }
    .template-btn {
      background: var(--card);
      border: 1px solid var(--border);
      color: var(--text-dim);
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 12px;
      cursor: pointer;
      transition: all 0.2s;
    }
    .template-btn:hover { border-color: var(--purple); color: var(--purple); }
    
    /* Notification Bell */
    .notification-bell {
      position: relative;
      cursor: pointer;
    }
    .notification-count {
      position: absolute;
      top: -5px;
      right: -5px;
      background: var(--red);
      color: white;
      font-size: 10px;
      width: 18px;
      height: 18px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .notification-dropdown {
      position: absolute;
      top: 40px;
      right: 0;
      width: 320px;
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 12px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.3);
      display: none;
      z-index: 50;
    }
    .notification-dropdown.open { display: block; }
    .notification-header {
      padding: 15px;
      border-bottom: 1px solid var(--border);
      font-weight: 600;
    }
    .notification-list { max-height: 300px; overflow-y: auto; }
    .notification-item {
      padding: 12px 15px;
      border-bottom: 1px solid var(--border);
      cursor: pointer;
      transition: background 0.2s;
    }
    .notification-item:hover { background: var(--card-hover); }
    .notification-item.unread { background: rgba(124, 58, 237, 0.1); }
    .notification-item .title { font-size: 14px; margin-bottom: 4px; }
    .notification-item .time { font-size: 11px; color: var(--text-dim); }
    
    /* Search */
    .search-box {
      position: relative;
    }
    .search-box input {
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 10px 15px 10px 40px;
      color: var(--text);
      width: 250px;
    }
    .search-box::before {
      content: 'üîç';
      position: absolute;
      left: 12px;
      top: 50%;
      transform: translateY(-50%);
      font-size: 14px;
    }
    
    /* Filter Tabs */
    .filter-tabs {
      display: flex;
      gap: 5px;
      margin-bottom: 20px;
    }
    .filter-tab {
      padding: 8px 16px;
      border: 1px solid var(--border);
      border-radius: 20px;
      background: transparent;
      color: var(--text-dim);
      font-size: 13px;
      cursor: pointer;
      transition: all 0.2s;
    }
    .filter-tab:hover { border-color: var(--purple); }
    .filter-tab.active { background: var(--purple); border-color: var(--purple); color: white; }
    
    /* Quick Actions */
    .quick-actions {
      display: flex;
      gap: 8px;
    }
    .quick-action {
      width: 32px;
      height: 32px;
      border-radius: 6px;
      border: 1px solid var(--border);
      background: transparent;
      color: var(--text-dim);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s;
    }
    .quick-action:hover { border-color: var(--purple); color: var(--purple); }
    
    /* Responsive */
    @media (max-width: 1200px) {
      .stats-grid { grid-template-columns: repeat(2, 1fr); }
    }
    @media (max-width: 900px) {
      .sidebar { display: none; }
      .main-content { margin-left: 0; }
    }
  </style>
</head>
<body>
  <div class="app-container">
    <!-- Sidebar -->
    <div class="sidebar">
      <div class="logo">Auto<span>Poster</span>Pro</div>
      
      <div class="user-info">
        <div class="name" id="userName">Sales User</div>
        <div class="role" id="userRole">Sales Representative</div>
      </div>
      
      <div class="nav-section">
        <div class="nav-section-title">Dashboard</div>
        <div class="nav-item active" onclick="showPanel('dashboard')">
          <span class="icon">üìä</span> Overview
        </div>
      </div>
      
      <div class="nav-section">
        <div class="nav-section-title">Sales</div>
        <div class="nav-item" onclick="showPanel('leads')">
          <span class="icon">üë•</span> Leads
          <span class="badge" id="newLeadsBadge">5</span>
        </div>
        <div class="nav-item" onclick="showPanel('pipeline')">
          <span class="icon">üìà</span> Pipeline
        </div>
        <div class="nav-item" onclick="showPanel('tasks')">
          <span class="icon">‚úÖ</span> Follow-ups
          <span class="badge" id="tasksBadge">3</span>
        </div>
      </div>
      
      <div class="nav-section">
        <div class="nav-section-title">Communication</div>
        <div class="nav-item" onclick="showPanel('emails')">
          <span class="icon">üìß</span> Emails
        </div>
        <div class="nav-item" onclick="showPanel('templates')">
          <span class="icon">üìù</span> Templates
        </div>
      </div>
      
      <div class="nav-section admin-only">
        <div class="nav-section-title">Admin</div>
        <div class="nav-item" onclick="showPanel('licenses')">
          <span class="icon">üîë</span> Licenses
        </div>
        <div class="nav-item" onclick="showPanel('users')">
          <span class="icon">üë§</span> Users
        </div>
        <div class="nav-item" onclick="showPanel('settings')">
          <span class="icon">‚öôÔ∏è</span> Settings
        </div>
      </div>
    </div>
    
    <!-- Main Content -->
    <div class="main-content">
      <!-- Top Bar -->
      <div class="page-header">
        <h1 id="pageTitle">Dashboard</h1>
        <div style="display: flex; align-items: center; gap: 20px;">
          <div class="search-box">
            <input type="text" placeholder="Search leads..." id="globalSearch">
          </div>
          <div class="notification-bell" onclick="toggleNotifications()">
            üîî
            <span class="notification-count" id="notifCount">3</span>
            <div class="notification-dropdown" id="notifDropdown">
              <div class="notification-header">Notifications</div>
              <div class="notification-list" id="notifList">
                <!-- Notifications will be populated -->
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Dashboard Panel -->
      <div class="panel active" id="panel-dashboard">
        <div class="stats-grid">
          <div class="stat-card">
            <div class="label">Total Leads</div>
            <div class="value" id="statTotalLeads">47</div>
            <div class="change up">‚Üë 12% this week</div>
          </div>
          <div class="stat-card">
            <div class="label">Hot Leads</div>
            <div class="value" id="statHotLeads">8</div>
            <div class="change up">‚Üë 3 new today</div>
          </div>
          <div class="stat-card">
            <div class="label">Emails Opened</div>
            <div class="value" id="statEmailsOpened">23</div>
            <div class="change up">‚Üë 68% open rate</div>
          </div>
          <div class="stat-card">
            <div class="label">Deals Won</div>
            <div class="value" id="statDealsWon">5</div>
            <div class="change">$8,395 MRR</div>
          </div>
        </div>
        
        <div class="table-container">
          <div class="table-header">
            <h3>üî• Hot Leads - Follow Up Today</h3>
          </div>
          <table>
            <thead>
              <tr>
                <th>Lead</th>
                <th>Company</th>
                <th>Status</th>
                <th>Last Activity</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="hotLeadsTable">
              <!-- Hot leads will be populated -->
            </tbody>
          </table>
        </div>
      </div>
      
      <!-- Leads Panel -->
      <div class="panel" id="panel-leads">
        <div class="filter-tabs">
          <button class="filter-tab active" onclick="filterLeads('all')">All Leads</button>
          <button class="filter-tab" onclick="filterLeads('new')">New</button>
          <button class="filter-tab" onclick="filterLeads('contacted')">Contacted</button>
          <button class="filter-tab" onclick="filterLeads('qualified')">Qualified</button>
          <button class="filter-tab" onclick="filterLeads('demo')">Demo Scheduled</button>
          <button class="filter-tab" onclick="filterLeads('proposal')">Proposal Sent</button>
        </div>
        
        <div class="table-container">
          <div class="table-header">
            <h3>All Leads</h3>
            <div class="table-actions">
              <button class="btn btn-primary" onclick="openAddLeadModal()">+ Add Lead</button>
              <button class="btn btn-outline" onclick="exportLeads()">Export CSV</button>
            </div>
          </div>
          <table>
            <thead>
              <tr>
                <th>Lead</th>
                <th>Company</th>
                <th>Status</th>
                <th>Priority</th>
                <th>Last Email</th>
                <th>Last Contact</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="leadsTable">
              <!-- Leads will be populated -->
            </tbody>
          </table>
        </div>
      </div>
      
      <!-- Pipeline Panel -->
      <div class="panel" id="panel-pipeline">
        <div style="display: grid; grid-template-columns: repeat(5, 1fr); gap: 15px;">
          <div class="pipeline-column" data-status="new">
            <h4 style="margin-bottom: 15px; color: var(--blue);">üì• New (12)</h4>
            <div id="pipeline-new" class="pipeline-cards"></div>
          </div>
          <div class="pipeline-column" data-status="contacted">
            <h4 style="margin-bottom: 15px; color: var(--purple);">üìû Contacted (8)</h4>
            <div id="pipeline-contacted" class="pipeline-cards"></div>
          </div>
          <div class="pipeline-column" data-status="qualified">
            <h4 style="margin-bottom: 15px; color: var(--yellow);">‚≠ê Qualified (5)</h4>
            <div id="pipeline-qualified" class="pipeline-cards"></div>
          </div>
          <div class="pipeline-column" data-status="demo">
            <h4 style="margin-bottom: 15px; color: var(--orange);">üé¨ Demo (3)</h4>
            <div id="pipeline-demo" class="pipeline-cards"></div>
          </div>
          <div class="pipeline-column" data-status="proposal">
            <h4 style="margin-bottom: 15px; color: var(--green);">üìÑ Proposal (2)</h4>
            <div id="pipeline-proposal" class="pipeline-cards"></div>
          </div>
        </div>
      </div>
      
      <!-- Tasks/Follow-ups Panel -->
      <div class="panel" id="panel-tasks">
        <div class="table-container">
          <div class="table-header">
            <h3>üìÖ Today's Follow-ups</h3>
            <button class="btn btn-primary" onclick="openAddTaskModal()">+ Add Task</button>
          </div>
          <table>
            <thead>
              <tr>
                <th>Task</th>
                <th>Lead</th>
                <th>Due</th>
                <th>Priority</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="tasksTable">
              <!-- Tasks will be populated -->
            </tbody>
          </table>
        </div>
      </div>
      
      <!-- Emails Panel -->
      <div class="panel" id="panel-emails">
        <div class="stats-grid" style="grid-template-columns: repeat(3, 1fr); margin-bottom: 20px;">
          <div class="stat-card">
            <div class="label">Emails Sent (30 days)</div>
            <div class="value">156</div>
          </div>
          <div class="stat-card">
            <div class="label">Open Rate</div>
            <div class="value">68%</div>
          </div>
          <div class="stat-card">
            <div class="label">Click Rate</div>
            <div class="value">24%</div>
          </div>
        </div>
        
        <div class="table-container">
          <div class="table-header">
            <h3>üìß Email Activity</h3>
            <button class="btn btn-primary" onclick="openComposeModal()">‚úâÔ∏è Compose Email</button>
          </div>
          <table>
            <thead>
              <tr>
                <th>Recipient</th>
                <th>Subject</th>
                <th>Status</th>
                <th>Sent</th>
                <th>Opened</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="emailsTable">
              <!-- Emails will be populated -->
            </tbody>
          </table>
        </div>
      </div>
      
      <!-- Templates Panel -->
      <div class="panel" id="panel-templates">
        <div class="table-container">
          <div class="table-header">
            <h3>üìù Email Templates</h3>
            <button class="btn btn-primary" onclick="openAddTemplateModal()">+ New Template</button>
          </div>
          <div style="padding: 20px; display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px;" id="templatesGrid">
            <!-- Templates will be populated -->
          </div>
        </div>
      </div>
      
      <!-- Admin Panels -->
      <div class="panel" id="panel-licenses">
        <div class="table-container">
          <div class="table-header">
            <h3>üîë Licenses</h3>
            <button class="btn btn-primary" onclick="openAddLicenseModal()">+ Create License</button>
          </div>
          <table>
            <thead>
              <tr>
                <th>License Key</th>
                <th>Dealer</th>
                <th>Plan</th>
                <th>Status</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="licensesTable">
              <!-- Licenses will be populated -->
            </tbody>
          </table>
        </div>
      </div>
      
      <div class="panel" id="panel-users">
        <div class="table-container">
          <div class="table-header">
            <h3>üë§ Team Members</h3>
            <button class="btn btn-primary" onclick="openAddUserModal()">+ Add User</button>
          </div>
          <table>
            <thead>
              <tr>
                <th>Name</th>
                <th>Email</th>
                <th>Role</th>
                <th>Status</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="usersTable">
              <!-- Users will be populated -->
            </tbody>
          </table>
        </div>
      </div>
      
      <div class="panel" id="panel-settings">
        <div class="table-container">
          <div style="padding: 30px;">
            <h3 style="margin-bottom: 20px;">‚öôÔ∏è Settings</h3>
            <div class="form-group">
              <label>Company Name</label>
              <input type="text" value="AutoPosterPro">
            </div>
            <div class="form-group">
              <label>Support Email</label>
              <input type="text" value="support@autoposterpro.com">
            </div>
            <div class="form-group">
              <label>Email Tracking</label>
              <select>
                <option>Enabled - Track opens and clicks</option>
                <option>Disabled</option>
              </select>
            </div>
            <button class="btn btn-primary">Save Settings</button>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Lead Detail Drawer -->
  <div class="drawer-overlay" id="leadDrawer">
    <div class="drawer">
      <div class="drawer-header">
        <h3>Lead Details</h3>
        <button class="drawer-close" onclick="closeDrawer()">√ó</button>
      </div>
      <div class="drawer-body" id="leadDrawerContent">
        <!-- Lead details will be populated -->
      </div>
    </div>
  </div>
  
  <!-- Add Lead Modal -->
  <div class="modal-overlay" id="addLeadModal">
    <div class="modal">
      <div class="modal-header">
        <h3>Add New Lead</h3>
        <button class="modal-close" onclick="closeModal('addLeadModal')">√ó</button>
      </div>
      <div class="modal-body">
        <form id="addLeadForm">
          <div class="form-row">
            <div class="form-group">
              <label>First Name *</label>
              <input type="text" name="firstName" required>
            </div>
            <div class="form-group">
              <label>Last Name *</label>
              <input type="text" name="lastName" required>
            </div>
          </div>
          <div class="form-group">
            <label>Email *</label>
            <input type="email" name="email" required>
          </div>
          <div class="form-group">
            <label>Phone</label>
            <input type="tel" name="phone">
          </div>
          <div class="form-group">
            <label>Company / Dealership *</label>
            <input type="text" name="company" required>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label>Status</label>
              <select name="status">
                <option value="new">New</option>
                <option value="contacted">Contacted</option>
                <option value="qualified">Qualified</option>
                <option value="demo">Demo Scheduled</option>
                <option value="proposal">Proposal Sent</option>
              </select>
            </div>
            <div class="form-group">
              <label>Priority</label>
              <select name="priority">
                <option value="hot">üî• Hot</option>
                <option value="warm">üå°Ô∏è Warm</option>
                <option value="cold">‚ùÑÔ∏è Cold</option>
              </select>
            </div>
          </div>
          <div class="form-group">
            <label>Interest</label>
            <select name="interest">
              <option value="starter">Starter ($219/mo)</option>
              <option value="professional">Professional ($1,199/mo)</option>
              <option value="enterprise">Enterprise ($1,799/mo)</option>
              <option value="unknown">Unknown</option>
            </select>
          </div>
          <div class="form-group">
            <label>Source</label>
            <select name="source">
              <option value="website">Website Contact Form</option>
              <option value="chat">Chat Widget</option>
              <option value="referral">Referral</option>
              <option value="cold-call">Cold Call</option>
              <option value="trade-show">Trade Show</option>
              <option value="other">Other</option>
            </select>
          </div>
          <div class="form-group">
            <label>Notes</label>
            <textarea name="notes" rows="3" placeholder="Initial notes about this lead..."></textarea>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button class="btn btn-outline" onclick="closeModal('addLeadModal')">Cancel</button>
        <button class="btn btn-primary" onclick="saveLead()">Add Lead</button>
      </div>
    </div>
  </div>
  
  <!-- Compose Email Modal -->
  <div class="modal-overlay" id="composeModal">
    <div class="modal" style="max-width: 700px;">
      <div class="modal-header">
        <h3>‚úâÔ∏è Compose Email</h3>
        <button class="modal-close" onclick="closeModal('composeModal')">√ó</button>
      </div>
      <div class="modal-body">
        <div class="template-selector">
          <span style="color: var(--text-dim); font-size: 12px; margin-right: 10px;">Templates:</span>
          <button class="template-btn" onclick="loadTemplate('intro')">Introduction</button>
          <button class="template-btn" onclick="loadTemplate('followup')">Follow Up</button>
          <button class="template-btn" onclick="loadTemplate('demo')">Demo Invite</button>
          <button class="template-btn" onclick="loadTemplate('proposal')">Proposal</button>
          <button class="template-btn" onclick="loadTemplate('checkin')">Check In</button>
        </div>
        
        <div class="email-composer">
          <div class="email-field">
            <label>To:</label>
            <input type="email" id="emailTo" placeholder="recipient@email.com">
          </div>
          <div class="email-field">
            <label>Subject:</label>
            <input type="text" id="emailSubject" placeholder="Email subject...">
          </div>
          <div class="email-field">
            <label>Message:</label>
            <textarea class="email-body" id="emailBody" placeholder="Write your message..."></textarea>
          </div>
          
          <!-- Attachments Section -->
          <div class="email-field" style="margin-top: 15px;">
            <label style="margin-bottom: 8px; display: block;">üìé Attachments:</label>
            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px;" id="attachmentsList">
              <label class="attachment-option" style="display: flex; align-items: center; gap: 8px; background: var(--bg); padding: 10px 12px; border-radius: 8px; cursor: pointer; border: 1px solid var(--border); transition: all 0.2s;">
                <input type="checkbox" name="attachment" value="one-pager" style="accent-color: var(--purple);">
                <span style="font-size: 13px;">üìÑ One-Page Overview</span>
              </label>
              <label class="attachment-option" style="display: flex; align-items: center; gap: 8px; background: var(--bg); padding: 10px 12px; border-radius: 8px; cursor: pointer; border: 1px solid var(--border); transition: all 0.2s;">
                <input type="checkbox" name="attachment" value="workflow" style="accent-color: var(--purple);">
                <span style="font-size: 13px;">üîÑ How It Works Guide</span>
              </label>
              <label class="attachment-option" style="display: flex; align-items: center; gap: 8px; background: var(--bg); padding: 10px 12px; border-radius: 8px; cursor: pointer; border: 1px solid var(--border); transition: all 0.2s;">
                <input type="checkbox" name="attachment" value="roi" style="accent-color: var(--purple);">
                <span style="font-size: 13px;">üí∞ ROI Calculator</span>
              </label>
              <label class="attachment-option" style="display: flex; align-items: center; gap: 8px; background: var(--bg); padding: 10px 12px; border-radius: 8px; cursor: pointer; border: 1px solid var(--border); transition: all 0.2s;">
                <input type="checkbox" name="attachment" value="pitch-deck" style="accent-color: var(--purple);">
                <span style="font-size: 13px;">üìä Full Pitch Deck</span>
              </label>
            </div>
            <p style="font-size: 11px; color: var(--text-dim); margin-top: 8px;">
              <a href="/assets/sales/" target="_blank" style="color: var(--purple);">Preview all sales materials ‚Üí</a>
            </p>
          </div>
          
          <div style="display: flex; align-items: center; gap: 10px; margin-top: 10px;">
            <label style="display: flex; align-items: center; gap: 5px; font-size: 13px; color: var(--text-dim);">
              <input type="checkbox" id="trackEmail" checked> Track opens & clicks
            </label>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-outline" onclick="closeModal('composeModal')">Cancel</button>
        <button class="btn btn-primary" onclick="sendEmail()">üì§ Send Email</button>
      </div>
    </div>
  </div>
  
  <!-- Add User Modal -->
  <div class="modal-overlay" id="addUserModal">
    <div class="modal">
      <div class="modal-header">
        <h3>Add Team Member</h3>
        <button class="modal-close" onclick="closeModal('addUserModal')">√ó</button>
      </div>
      <div class="modal-body">
        <form id="addUserForm">
          <div class="form-row">
            <div class="form-group">
              <label>First Name *</label>
              <input type="text" name="firstName" required>
            </div>
            <div class="form-group">
              <label>Last Name *</label>
              <input type="text" name="lastName" required>
            </div>
          </div>
          <div class="form-group">
            <label>Email *</label>
            <input type="email" name="email" required>
          </div>
          <div class="form-group">
            <label>Password *</label>
            <input type="password" name="password" required>
          </div>
          <div class="form-group">
            <label>Role *</label>
            <select name="role">
              <option value="sales">Sales Representative</option>
              <option value="manager">Sales Manager</option>
              <option value="admin">Administrator</option>
            </select>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button class="btn btn-outline" onclick="closeModal('addUserModal')">Cancel</button>
        <button class="btn btn-primary" onclick="saveUser()">Add User</button>
      </div>
    </div>
  </div>

  <script>
    // ============================================
    // SALES CRM DASHBOARD
    // ============================================
    
    // Current user (would come from auth)
    let currentUser = {
      name: 'John Smith',
      role: 'sales', // 'sales', 'manager', 'admin'
      email: 'john@autoposterpro.com'
    };
    
    // Sample data
    let leads = [
      { id: 1, firstName: 'Mike', lastName: 'Johnson', email: 'mike@abcmotors.com', phone: '555-0101', company: 'ABC Motors', status: 'new', priority: 'hot', interest: 'professional', source: 'website', createdAt: '2026-01-25', lastContact: '2026-01-25', notes: [], activities: [], emails: [] },
      { id: 2, firstName: 'Sarah', lastName: 'Williams', email: 'sarah@premiumauto.com', phone: '555-0102', company: 'Premium Auto Group', status: 'demo', priority: 'hot', interest: 'enterprise', source: 'referral', createdAt: '2026-01-20', lastContact: '2026-01-24', notes: [], activities: [], emails: [] },
      { id: 3, firstName: 'Tom', lastName: 'Davis', email: 'tom@citycars.com', phone: '555-0103', company: 'City Cars', status: 'contacted', priority: 'warm', interest: 'starter', source: 'chat', createdAt: '2026-01-22', lastContact: '2026-01-23', notes: [], activities: [], emails: [] },
      { id: 4, firstName: 'Lisa', lastName: 'Brown', email: 'lisa@elitedealer.com', phone: '555-0104', company: 'Elite Dealer Network', status: 'qualified', priority: 'hot', interest: 'enterprise', source: 'trade-show', createdAt: '2026-01-18', lastContact: '2026-01-26', notes: [], activities: [], emails: [] },
      { id: 5, firstName: 'James', lastName: 'Wilson', email: 'james@quicksale.com', phone: '555-0105', company: 'QuickSale Autos', status: 'proposal', priority: 'hot', interest: 'professional', source: 'cold-call', createdAt: '2026-01-15', lastContact: '2026-01-25', notes: [], activities: [], emails: [] },
    ];
    
    let notifications = [
      { id: 1, title: 'üìß Mike Johnson opened your email', time: '5 min ago', unread: true, leadId: 1 },
      { id: 2, title: 'üî• New hot lead: Sarah Williams', time: '1 hour ago', unread: true, leadId: 2 },
      { id: 3, title: 'üìß Tom Davis clicked pricing link', time: '2 hours ago', unread: true, leadId: 3 },
    ];
    
    let emailTemplates = [
      { id: 'intro', name: 'Introduction', subject: 'Quick question about {{company}}', body: 'Hi {{firstName}},\n\nI noticed {{company}} is in the auto business and wanted to reach out.\n\nWe help dealers like yours post to Facebook Marketplace 10x faster with AI-powered automation. Would you be open to a quick chat this week?\n\nBest,\n{{senderName}}' },
      { id: 'followup', name: 'Follow Up', subject: 'Following up - AutoPosterPro', body: 'Hi {{firstName}},\n\nJust wanted to follow up on my previous email. I know you\'re busy, but I think AutoPosterPro could save {{company}} a lot of time.\n\nDo you have 15 minutes this week for a quick call?\n\nBest,\n{{senderName}}' },
      { id: 'demo', name: 'Demo Invite', subject: 'Ready to see AutoPosterPro in action?', body: 'Hi {{firstName}},\n\nI\'d love to show you how AutoPosterPro works. It only takes 15 minutes and I think you\'ll be impressed.\n\nHere\'s my calendar link to book a time: [CALENDAR_LINK]\n\nLooking forward to it!\n\n{{senderName}}' },
      { id: 'proposal', name: 'Proposal', subject: 'Your AutoPosterPro Proposal', body: 'Hi {{firstName}},\n\nThanks for your time on our call! As discussed, I\'ve put together a proposal for {{company}}.\n\nBased on your team size, I recommend our {{interest}} plan. Here\'s what\'s included:\n\n‚Ä¢ AI-Powered Descriptions\n‚Ä¢ Automated Image Transfer\n‚Ä¢ Full Email Support\n‚Ä¢ Free Onboarding\n\nReady to get started? Let me know and I\'ll send over the agreement.\n\nBest,\n{{senderName}}' },
      { id: 'checkin', name: 'Check In', subject: 'Checking in - {{company}}', body: 'Hi {{firstName}},\n\nJust wanted to check in and see if you had any questions about AutoPosterPro.\n\nWe\'re currently running some promotions - happy to discuss if you\'re interested.\n\nBest,\n{{senderName}}' },
    ];
    
    // Initialize
    document.addEventListener('DOMContentLoaded', () => {
      initDashboard();
    });
    
    function initDashboard() {
      // Set user info
      document.getElementById('userName').textContent = currentUser.name;
      document.getElementById('userRole').textContent = currentUser.role === 'admin' ? 'Administrator' : currentUser.role === 'manager' ? 'Sales Manager' : 'Sales Representative';
      
      // Hide admin sections for non-admins
      if (currentUser.role !== 'admin') {
        document.querySelectorAll('.admin-only').forEach(el => el.style.display = 'none');
      }
      
      // Load data
      renderHotLeads();
      renderLeads();
      renderNotifications();
      renderTemplates();
      updateBadges();
    }
    
    // Navigation
    function showPanel(panel) {
      document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
      document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
      
      document.getElementById('panel-' + panel).classList.add('active');
      event.target.closest('.nav-item').classList.add('active');
      
      const titles = {
        dashboard: 'Dashboard',
        leads: 'Leads',
        pipeline: 'Sales Pipeline',
        tasks: 'Follow-ups',
        emails: 'Email Activity',
        templates: 'Email Templates',
        licenses: 'Licenses',
        users: 'Team Members',
        settings: 'Settings'
      };
      document.getElementById('pageTitle').textContent = titles[panel] || 'Dashboard';
    }
    
    // Render functions
    function renderHotLeads() {
      const hotLeads = leads.filter(l => l.priority === 'hot').slice(0, 5);
      const tbody = document.getElementById('hotLeadsTable');
      tbody.innerHTML = hotLeads.map(lead => `
        <tr onclick="openLeadDrawer(${lead.id})" style="cursor: pointer;">
          <td>
            <strong>${lead.firstName} ${lead.lastName}</strong><br>
            <span style="color: var(--text-dim); font-size: 12px;">${lead.email}</span>
          </td>
          <td>${lead.company}</td>
          <td><span class="status status-${lead.status}">${formatStatus(lead.status)}</span></td>
          <td>${formatDate(lead.lastContact)}</td>
          <td>
            <div class="quick-actions">
              <button class="quick-action" onclick="event.stopPropagation(); openComposeFor(${lead.id})" title="Send Email">üìß</button>
              <button class="quick-action" onclick="event.stopPropagation(); addQuickNote(${lead.id})" title="Add Note">üìù</button>
              <button class="quick-action" onclick="event.stopPropagation(); callLead(${lead.id})" title="Call">üìû</button>
            </div>
          </td>
        </tr>
      `).join('');
    }
    
    function renderLeads(filter = 'all') {
      let filtered = filter === 'all' ? leads : leads.filter(l => l.status === filter);
      const tbody = document.getElementById('leadsTable');
      tbody.innerHTML = filtered.map(lead => `
        <tr onclick="openLeadDrawer(${lead.id})" style="cursor: pointer;">
          <td>
            <strong>${lead.firstName} ${lead.lastName}</strong><br>
            <span style="color: var(--text-dim); font-size: 12px;">${lead.email}</span>
          </td>
          <td>${lead.company}</td>
          <td><span class="status status-${lead.status}">${formatStatus(lead.status)}</span></td>
          <td>
            <div class="priority">
              <span class="priority-dot priority-${lead.priority}"></span>
              ${lead.priority.charAt(0).toUpperCase() + lead.priority.slice(1)}
            </div>
          </td>
          <td>
            ${lead.emails && lead.emails.length > 0 ? `
              <div class="email-status ${lead.emails[0].opened ? 'opened' : 'sent'}">
                ${lead.emails[0].opened ? '‚úÖ Opened' : 'üì§ Sent'}
              </div>
            ` : '<span style="color: var(--text-dim);">No emails</span>'}
          </td>
          <td>${formatDate(lead.lastContact)}</td>
          <td>
            <div class="quick-actions">
              <button class="quick-action" onclick="event.stopPropagation(); openComposeFor(${lead.id})" title="Send Email">üìß</button>
              <button class="quick-action" onclick="event.stopPropagation(); addQuickNote(${lead.id})" title="Add Note">üìù</button>
            </div>
          </td>
        </tr>
      `).join('');
    }
    
    function renderNotifications() {
      const list = document.getElementById('notifList');
      list.innerHTML = notifications.map(n => `
        <div class="notification-item ${n.unread ? 'unread' : ''}" onclick="handleNotification(${n.id})">
          <div class="title">${n.title}</div>
          <div class="time">${n.time}</div>
        </div>
      `).join('');
      
      document.getElementById('notifCount').textContent = notifications.filter(n => n.unread).length;
    }
    
    function renderTemplates() {
      const grid = document.getElementById('templatesGrid');
      grid.innerHTML = emailTemplates.map(t => `
        <div style="background: var(--bg); border-radius: 12px; padding: 20px;">
          <h4 style="margin-bottom: 10px;">${t.name}</h4>
          <p style="color: var(--text-dim); font-size: 13px; margin-bottom: 15px;">${t.subject}</p>
          <button class="btn btn-sm btn-outline" onclick="editTemplate('${t.id}')">Edit</button>
          <button class="btn btn-sm btn-primary" onclick="useTemplate('${t.id}')">Use</button>
        </div>
      `).join('');
    }
    
    function updateBadges() {
      document.getElementById('newLeadsBadge').textContent = leads.filter(l => l.status === 'new').length;
      document.getElementById('tasksBadge').textContent = leads.filter(l => l.priority === 'hot').length;
    }
    
    // Lead Drawer
    function openLeadDrawer(leadId) {
      const lead = leads.find(l => l.id === leadId);
      if (!lead) return;
      
      const content = document.getElementById('leadDrawerContent');
      content.innerHTML = `
        <div class="lead-header">
          <div class="lead-avatar">${lead.firstName[0]}${lead.lastName[0]}</div>
          <div class="lead-name">${lead.firstName} ${lead.lastName}</div>
          <div class="lead-company">${lead.company}</div>
          <div style="display: flex; gap: 10px; justify-content: center;">
            <span class="status status-${lead.status}">${formatStatus(lead.status)}</span>
            <span class="status" style="background: rgba(124,58,237,0.2); color: var(--purple);">${lead.interest}</span>
          </div>
        </div>
        
        <div style="display: flex; gap: 10px; margin-bottom: 25px;">
          <button class="btn btn-primary" style="flex:1" onclick="openComposeFor(${lead.id})">üìß Email</button>
          <button class="btn btn-outline" style="flex:1" onclick="callLead(${lead.id})">üìû Call</button>
        </div>
        
        <div class="detail-section">
          <h4>üìã Contact Info</h4>
          <div class="detail-row">
            <span class="detail-label">Email</span>
            <span>${lead.email}</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Phone</span>
            <span>${lead.phone || 'Not provided'}</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Source</span>
            <span>${lead.source}</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Created</span>
            <span>${formatDate(lead.createdAt)}</span>
          </div>
        </div>
        
        <div class="detail-section">
          <h4>üè∑Ô∏è Status & Priority</h4>
          <div class="form-row" style="margin-top: 10px;">
            <select onchange="updateLeadStatus(${lead.id}, this.value)" style="flex:1; padding: 10px; background: var(--bg); border: 1px solid var(--border); border-radius: 8px; color: var(--text);">
              <option value="new" ${lead.status === 'new' ? 'selected' : ''}>New</option>
              <option value="contacted" ${lead.status === 'contacted' ? 'selected' : ''}>Contacted</option>
              <option value="qualified" ${lead.status === 'qualified' ? 'selected' : ''}>Qualified</option>
              <option value="demo" ${lead.status === 'demo' ? 'selected' : ''}>Demo Scheduled</option>
              <option value="proposal" ${lead.status === 'proposal' ? 'selected' : ''}>Proposal Sent</option>
              <option value="won" ${lead.status === 'won' ? 'selected' : ''}>Won üéâ</option>
              <option value="lost" ${lead.status === 'lost' ? 'selected' : ''}>Lost</option>
            </select>
            <select onchange="updateLeadPriority(${lead.id}, this.value)" style="flex:1; padding: 10px; background: var(--bg); border: 1px solid var(--border); border-radius: 8px; color: var(--text);">
              <option value="hot" ${lead.priority === 'hot' ? 'selected' : ''}>üî• Hot</option>
              <option value="warm" ${lead.priority === 'warm' ? 'selected' : ''}>üå°Ô∏è Warm</option>
              <option value="cold" ${lead.priority === 'cold' ? 'selected' : ''}>‚ùÑÔ∏è Cold</option>
            </select>
          </div>
        </div>
        
        <div class="detail-section">
          <h4>üìù Notes</h4>
          <div class="notes-list" id="notesList-${lead.id}">
            ${(lead.notes || []).map(note => `
              <div class="note-item">
                <div class="note-header">
                  <span>${note.author}</span>
                  <span>${formatDate(note.date)}</span>
                </div>
                <div class="note-text">${note.text}</div>
              </div>
            `).join('') || '<p style="color: var(--text-dim); font-size: 13px;">No notes yet</p>'}
          </div>
          <textarea class="note-input" id="newNote-${lead.id}" placeholder="Add a note..."></textarea>
          <button class="btn btn-sm btn-primary" style="margin-top: 10px;" onclick="saveNote(${lead.id})">Add Note</button>
        </div>
        
        <div class="detail-section">
          <h4>üìÖ Activity Timeline</h4>
          <div class="timeline" id="timeline-${lead.id}">
            ${(lead.activities || []).map(act => `
              <div class="timeline-item ${act.type}">
                <div class="timeline-time">${formatDateTime(act.date)}</div>
                <div class="timeline-content">${act.text}</div>
              </div>
            `).join('') || '<p style="color: var(--text-dim); font-size: 13px;">No activity yet</p>'}
          </div>
        </div>
      `;
      
      document.getElementById('leadDrawer').classList.add('open');
    }
    
    function closeDrawer() {
      document.getElementById('leadDrawer').classList.remove('open');
    }
    
    // Lead Actions
    function updateLeadStatus(leadId, status) {
      const lead = leads.find(l => l.id === leadId);
      if (lead) {
        lead.status = status;
        lead.activities = lead.activities || [];
        lead.activities.unshift({ type: 'status', date: new Date().toISOString(), text: `Status changed to ${formatStatus(status)}` });
        renderLeads();
        renderHotLeads();
      }
    }
    
    function updateLeadPriority(leadId, priority) {
      const lead = leads.find(l => l.id === leadId);
      if (lead) {
        lead.priority = priority;
        renderLeads();
        renderHotLeads();
      }
    }
    
    function saveNote(leadId) {
      const textarea = document.getElementById(`newNote-${leadId}`);
      const text = textarea.value.trim();
      if (!text) return;
      
      const lead = leads.find(l => l.id === leadId);
      if (lead) {
        lead.notes = lead.notes || [];
        lead.notes.unshift({ author: currentUser.name, date: new Date().toISOString(), text });
        lead.activities = lead.activities || [];
        lead.activities.unshift({ type: 'note', date: new Date().toISOString(), text: `Note added: "${text.substring(0, 50)}..."` });
        textarea.value = '';
        openLeadDrawer(leadId); // Refresh
      }
    }
    
    function addQuickNote(leadId) {
      const note = prompt('Add a quick note:');
      if (note) {
        const lead = leads.find(l => l.id === leadId);
        if (lead) {
          lead.notes = lead.notes || [];
          lead.notes.unshift({ author: currentUser.name, date: new Date().toISOString(), text: note });
          lead.activities = lead.activities || [];
          lead.activities.unshift({ type: 'note', date: new Date().toISOString(), text: `Note added: "${note.substring(0, 50)}..."` });
          alert('Note added!');
        }
      }
    }
    
    // Email functions
    function openComposeModal() {
      document.getElementById('emailTo').value = '';
      document.getElementById('emailSubject').value = '';
      document.getElementById('emailBody').value = '';
      document.getElementById('composeModal').classList.add('open');
    }
    
    function openComposeFor(leadId) {
      const lead = leads.find(l => l.id === leadId);
      if (!lead) return;
      
      document.getElementById('emailTo').value = lead.email;
      document.getElementById('emailSubject').value = '';
      document.getElementById('emailBody').value = '';
      document.getElementById('composeModal').classList.add('open');
      
      // Store current lead for template filling
      window.currentEmailLead = lead;
    }
    
    function loadTemplate(templateId) {
      const template = emailTemplates.find(t => t.id === templateId);
      if (!template) return;
      
      let subject = template.subject;
      let body = template.body;
      
      // Fill in placeholders if we have a lead
      if (window.currentEmailLead) {
        const lead = window.currentEmailLead;
        subject = subject.replace(/\{\{company\}\}/g, lead.company)
                        .replace(/\{\{firstName\}\}/g, lead.firstName)
                        .replace(/\{\{lastName\}\}/g, lead.lastName)
                        .replace(/\{\{interest\}\}/g, lead.interest);
        body = body.replace(/\{\{company\}\}/g, lead.company)
                   .replace(/\{\{firstName\}\}/g, lead.firstName)
                   .replace(/\{\{lastName\}\}/g, lead.lastName)
                   .replace(/\{\{interest\}\}/g, lead.interest)
                   .replace(/\{\{senderName\}\}/g, currentUser.name);
      }
      
      document.getElementById('emailSubject').value = subject;
      document.getElementById('emailBody').value = body;
    }
    
    function sendEmail() {
      const to = document.getElementById('emailTo').value;
      const subject = document.getElementById('emailSubject').value;
      const body = document.getElementById('emailBody').value;
      const track = document.getElementById('trackEmail').checked;
      
      // Get selected attachments
      const attachmentCheckboxes = document.querySelectorAll('input[name="attachment"]:checked');
      const attachments = Array.from(attachmentCheckboxes).map(cb => cb.value);
      
      if (!to || !subject || !body) {
        alert('Please fill in all fields');
        return;
      }
      
      // Find lead and add to their emails
      const lead = leads.find(l => l.email === to);
      if (lead) {
        lead.emails = lead.emails || [];
        lead.emails.unshift({ 
          subject, 
          sent: new Date().toISOString(), 
          opened: false, 
          clicked: false, 
          tracked: track,
          attachments: attachments
        });
        lead.activities = lead.activities || [];
        const attachmentNote = attachments.length > 0 ? ` (with ${attachments.length} attachment${attachments.length > 1 ? 's' : ''})` : '';
        lead.activities.unshift({ type: 'email', date: new Date().toISOString(), text: `Email sent: "${subject}"${attachmentNote}` });
        lead.lastContact = new Date().toISOString().split('T')[0];
        if (lead.status === 'new') lead.status = 'contacted';
      }
      
      // In real app, would call API to send email
      let message = 'Email sent successfully!';
      if (attachments.length > 0) {
        message += ` (${attachments.length} attachment${attachments.length > 1 ? 's' : ''} included)`;
      }
      if (track) {
        message += ' - Tracking enabled';
      }
      alert(message);
      closeModal('composeModal');
      
      // Clear attachment selections
      document.querySelectorAll('input[name="attachment"]').forEach(cb => cb.checked = false);
      
      renderLeads();
    }
    
    // Modal functions
    function openAddLeadModal() {
      document.getElementById('addLeadForm').reset();
      document.getElementById('addLeadModal').classList.add('open');
    }
    
    function openAddUserModal() {
      document.getElementById('addUserForm').reset();
      document.getElementById('addUserModal').classList.add('open');
    }
    
    function closeModal(modalId) {
      document.getElementById(modalId).classList.remove('open');
    }
    
    function saveLead() {
      const form = document.getElementById('addLeadForm');
      const formData = new FormData(form);
      
      const newLead = {
        id: leads.length + 1,
        firstName: formData.get('firstName'),
        lastName: formData.get('lastName'),
        email: formData.get('email'),
        phone: formData.get('phone'),
        company: formData.get('company'),
        status: formData.get('status'),
        priority: formData.get('priority'),
        interest: formData.get('interest'),
        source: formData.get('source'),
        createdAt: new Date().toISOString().split('T')[0],
        lastContact: new Date().toISOString().split('T')[0],
        notes: formData.get('notes') ? [{ author: currentUser.name, date: new Date().toISOString(), text: formData.get('notes') }] : [],
        activities: [{ type: 'status', date: new Date().toISOString(), text: 'Lead created' }],
        emails: []
      };
      
      leads.unshift(newLead);
      closeModal('addLeadModal');
      renderLeads();
      renderHotLeads();
      updateBadges();
      alert('Lead added successfully!');
    }
    
    function saveUser() {
      alert('User added! (In real app, would save to database)');
      closeModal('addUserModal');
    }
    
    // Notifications
    function toggleNotifications() {
      document.getElementById('notifDropdown').classList.toggle('open');
    }
    
    function handleNotification(notifId) {
      const notif = notifications.find(n => n.id === notifId);
      if (notif) {
        notif.unread = false;
        renderNotifications();
        if (notif.leadId) openLeadDrawer(notif.leadId);
      }
    }
    
    // Filter
    function filterLeads(status) {
      document.querySelectorAll('.filter-tab').forEach(t => t.classList.remove('active'));
      event.target.classList.add('active');
      renderLeads(status);
    }
    
    // Helpers
    function formatStatus(status) {
      const labels = {
        new: 'New',
        contacted: 'Contacted',
        qualified: 'Qualified',
        demo: 'Demo Scheduled',
        proposal: 'Proposal Sent',
        won: 'Won üéâ',
        lost: 'Lost'
      };
      return labels[status] || status;
    }
    
    function formatDate(dateStr) {
      if (!dateStr) return 'N/A';
      return new Date(dateStr).toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
    }
    
    function formatDateTime(dateStr) {
      if (!dateStr) return 'N/A';
      return new Date(dateStr).toLocaleString('en-US', { month: 'short', day: 'numeric', hour: 'numeric', minute: '2-digit' });
    }
    
    function callLead(leadId) {
      const lead = leads.find(l => l.id === leadId);
      if (lead && lead.phone) {
        window.open('tel:' + lead.phone);
        lead.activities = lead.activities || [];
        lead.activities.unshift({ type: 'call', date: new Date().toISOString(), text: 'Phone call initiated' });
      } else {
        alert('No phone number on file');
      }
    }
    
    function exportLeads() {
      alert('Exporting leads to CSV... (would download file)');
    }
    
    // Close modals on outside click
    document.querySelectorAll('.modal-overlay').forEach(modal => {
      modal.addEventListener('click', (e) => {
        if (e.target === modal) modal.classList.remove('open');
      });
    });
    
    document.getElementById('leadDrawer').addEventListener('click', (e) => {
      if (e.target.id === 'leadDrawer') closeDrawer();
    });
    
    // Close notification dropdown when clicking outside
    document.addEventListener('click', (e) => {
      if (!e.target.closest('.notification-bell')) {
        document.getElementById('notifDropdown').classList.remove('open');
      }
    });
  </script>
</body>
</html>
