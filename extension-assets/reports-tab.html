<!-- ============================================
     REPORTS TAB - Add to your extension popup.html
     ============================================ -->

<!-- Add this tab button to your existing tabs -->
<button class="tab-btn" data-tab="reports">üìä Reports</button>

<!-- Add this tab content section -->
<div class="tab-content" id="tab-reports" style="display: none;">
  <div class="reports-container">
    
    <!-- Summary Cards -->
    <div class="report-summary">
      <div class="summary-card">
        <div class="summary-icon">üìÖ</div>
        <div class="summary-value" id="postsToday">0</div>
        <div class="summary-label">Posts Today</div>
      </div>
      <div class="summary-card">
        <div class="summary-icon">üìÜ</div>
        <div class="summary-value" id="postsWeek">0</div>
        <div class="summary-label">This Week</div>
      </div>
      <div class="summary-card">
        <div class="summary-icon">üìä</div>
        <div class="summary-value" id="postsMonth">0</div>
        <div class="summary-label">This Month</div>
      </div>
      <div class="summary-card">
        <div class="summary-icon">üèÜ</div>
        <div class="summary-value" id="postsAllTime">0</div>
        <div class="summary-label">All Time</div>
      </div>
    </div>
    
    <!-- Performance Metrics -->
    <div class="report-section">
      <h3>‚ö° Performance</h3>
      <div class="metric-row">
        <span class="metric-label">Avg. Posts/Day</span>
        <span class="metric-value" id="avgPostsDay">0</span>
      </div>
      <div class="metric-row">
        <span class="metric-label">Avg. Time per Post</span>
        <span class="metric-value" id="avgTimePost">0s</span>
      </div>
      <div class="metric-row">
        <span class="metric-label">Time Saved (est.)</span>
        <span class="metric-value highlight" id="timeSaved">0 hrs</span>
      </div>
    </div>
    
    <!-- Time Tracking -->
    <div class="report-section">
      <h3>‚è±Ô∏è Time Spent</h3>
      <div class="metric-row">
        <span class="metric-label">Today</span>
        <span class="metric-value" id="timeToday">0 min</span>
      </div>
      <div class="metric-row">
        <span class="metric-label">This Week</span>
        <span class="metric-value" id="timeWeek">0 min</span>
      </div>
      <div class="metric-row">
        <span class="metric-label">This Month</span>
        <span class="metric-value" id="timeMonth">0 min</span>
      </div>
    </div>
    
    <!-- Weekly Chart -->
    <div class="report-section">
      <h3>üìà Last 7 Days</h3>
      <div class="chart-container" id="weeklyChart">
        <!-- Chart bars will be inserted here -->
      </div>
    </div>
    
    <!-- ROI Calculator -->
    <div class="report-section roi-section">
      <h3>üí∞ Your ROI</h3>
      <p class="roi-description">Based on 14 min saved per post @ $30/hr</p>
      <div class="roi-value" id="roiValue">$0</div>
      <div class="roi-label">estimated value this month</div>
    </div>
    
    <button class="btn-refresh" onclick="loadReports()">üîÑ Refresh Stats</button>
  </div>
</div>

<style>
  /* Reports Tab Styles */
  .reports-container {
    padding: 15px;
  }
  
  .report-summary {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 10px;
    margin-bottom: 20px;
  }
  
  .summary-card {
    background: linear-gradient(135deg, rgba(124, 58, 237, 0.1) 0%, rgba(249, 115, 22, 0.1) 100%);
    border: 1px solid rgba(124, 58, 237, 0.3);
    border-radius: 12px;
    padding: 15px;
    text-align: center;
  }
  
  .summary-icon {
    font-size: 24px;
    margin-bottom: 5px;
  }
  
  .summary-value {
    font-size: 28px;
    font-weight: 800;
    color: #7c3aed;
  }
  
  .summary-label {
    font-size: 11px;
    color: #a1a1aa;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }
  
  .report-section {
    background: #1a1425;
    border: 1px solid #2d2640;
    border-radius: 12px;
    padding: 15px;
    margin-bottom: 15px;
  }
  
  .report-section h3 {
    font-size: 14px;
    margin-bottom: 12px;
    color: #fff;
  }
  
  .metric-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 8px 0;
    border-bottom: 1px solid #2d2640;
  }
  
  .metric-row:last-child {
    border-bottom: none;
  }
  
  .metric-label {
    color: #a1a1aa;
    font-size: 13px;
  }
  
  .metric-value {
    font-weight: 600;
    color: #fff;
    font-size: 14px;
  }
  
  .metric-value.highlight {
    color: #22c55e;
    font-size: 16px;
  }
  
  /* Weekly Chart */
  .chart-container {
    display: flex;
    align-items: flex-end;
    justify-content: space-between;
    height: 100px;
    padding: 10px 0;
    gap: 8px;
  }
  
  .chart-bar {
    flex: 1;
    background: linear-gradient(180deg, #7c3aed 0%, #6d28d9 100%);
    border-radius: 4px 4px 0 0;
    min-height: 4px;
    position: relative;
    transition: height 0.3s ease;
  }
  
  .chart-bar:hover {
    background: linear-gradient(180deg, #f97316 0%, #ea580c 100%);
  }
  
  .chart-bar-label {
    position: absolute;
    bottom: -20px;
    left: 50%;
    transform: translateX(-50%);
    font-size: 10px;
    color: #a1a1aa;
  }
  
  .chart-bar-value {
    position: absolute;
    top: -18px;
    left: 50%;
    transform: translateX(-50%);
    font-size: 11px;
    color: #fff;
    font-weight: 600;
  }
  
  /* ROI Section */
  .roi-section {
    text-align: center;
    background: linear-gradient(135deg, rgba(34, 197, 94, 0.1) 0%, rgba(124, 58, 237, 0.1) 100%);
    border-color: rgba(34, 197, 94, 0.3);
  }
  
  .roi-description {
    font-size: 11px;
    color: #a1a1aa;
    margin-bottom: 10px;
  }
  
  .roi-value {
    font-size: 36px;
    font-weight: 800;
    color: #22c55e;
  }
  
  .roi-label {
    font-size: 12px;
    color: #a1a1aa;
    margin-top: 5px;
  }
  
  .btn-refresh {
    width: 100%;
    padding: 12px;
    background: transparent;
    border: 1px solid #2d2640;
    border-radius: 8px;
    color: #a1a1aa;
    font-size: 13px;
    cursor: pointer;
    transition: all 0.2s;
  }
  
  .btn-refresh:hover {
    border-color: #7c3aed;
    color: #7c3aed;
  }
  
  /* Loading state */
  .reports-loading {
    text-align: center;
    padding: 40px;
    color: #a1a1aa;
  }
  
  .reports-loading .spinner {
    width: 40px;
    height: 40px;
    border: 3px solid #2d2640;
    border-top-color: #7c3aed;
    border-radius: 50%;
    animation: spin 1s linear infinite;
    margin: 0 auto 15px;
  }
  
  @keyframes spin {
    to { transform: rotate(360deg); }
  }
</style>

<script>
// Reports Tab JavaScript
async function loadReports() {
  const container = document.querySelector('.reports-container');
  
  // Show loading
  container.innerHTML = `
    <div class="reports-loading">
      <div class="spinner"></div>
      <p>Loading your stats...</p>
    </div>
  `;
  
  try {
    const stats = await Analytics.getStats();
    
    if (!stats) {
      container.innerHTML = '<p style="text-align:center;color:#a1a1aa;padding:40px;">No data available yet. Start posting to see your stats!</p>';
      return;
    }
    
    // Restore container HTML and populate data
    container.innerHTML = getReportsHTML();
    
    // Populate summary cards
    document.getElementById('postsToday').textContent = stats.today?.posts || 0;
    document.getElementById('postsWeek').textContent = stats.thisWeek?.posts || 0;
    document.getElementById('postsMonth').textContent = stats.thisMonth?.posts || 0;
    document.getElementById('postsAllTime').textContent = stats.lifetime?.totalPosts || 0;
    
    // Populate metrics
    document.getElementById('avgPostsDay').textContent = stats.averages?.postsPerDayMonth || 0;
    
    const avgTimePerPost = stats.averages?.avgTimePerPostSeconds || 0;
    document.getElementById('avgTimePost').textContent = avgTimePerPost > 60 
      ? `${Math.round(avgTimePerPost / 60)}m ${avgTimePerPost % 60}s`
      : `${avgTimePerPost}s`;
    
    // Time saved calculation (assuming 15 min saved per post vs manual)
    const postsThisMonth = stats.thisMonth?.posts || 0;
    const timeSavedMinutes = postsThisMonth * 14; // 15 min manual - 1 min with tool = 14 min saved
    const timeSavedHours = Math.round(timeSavedMinutes / 60 * 10) / 10;
    document.getElementById('timeSaved').textContent = `${timeSavedHours} hrs`;
    
    // Time tracking
    const todayTime = stats.today?.totalTimeSeconds || 0;
    const weekTime = stats.thisWeek?.timeSeconds || 0;
    const monthTime = stats.thisMonth?.timeSeconds || 0;
    
    document.getElementById('timeToday').textContent = formatTime(todayTime);
    document.getElementById('timeWeek').textContent = formatTime(weekTime);
    document.getElementById('timeMonth').textContent = formatTime(monthTime);
    
    // ROI calculation ($30/hr * hours saved)
    const roiValue = Math.round(timeSavedHours * 30);
    document.getElementById('roiValue').textContent = `$${roiValue.toLocaleString()}`;
    
    // Weekly chart
    renderWeeklyChart(stats.thisWeek?.days || []);
    
  } catch (error) {
    console.error('Failed to load reports:', error);
    container.innerHTML = '<p style="text-align:center;color:#ef4444;padding:40px;">Failed to load stats. Please try again.</p>';
  }
}

function formatTime(seconds) {
  if (seconds < 60) return `${seconds}s`;
  if (seconds < 3600) return `${Math.round(seconds / 60)} min`;
  const hours = Math.floor(seconds / 3600);
  const mins = Math.round((seconds % 3600) / 60);
  return `${hours}h ${mins}m`;
}

function renderWeeklyChart(days) {
  const container = document.getElementById('weeklyChart');
  if (!container) return;
  
  // Get last 7 days in order
  const dayNames = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
  const chartData = [];
  
  for (let i = 6; i >= 0; i--) {
    const date = new Date();
    date.setDate(date.getDate() - i);
    const dateStr = date.toISOString().split('T')[0];
    const dayData = days.find(d => d.date === dateStr);
    
    chartData.push({
      day: dayNames[date.getDay()],
      posts: dayData?.posts || 0
    });
  }
  
  // Find max for scaling
  const maxPosts = Math.max(...chartData.map(d => d.posts), 1);
  
  // Render bars
  container.innerHTML = chartData.map(d => {
    const height = Math.max((d.posts / maxPosts) * 80, 4);
    return `
      <div class="chart-bar" style="height: ${height}px;">
        <span class="chart-bar-value">${d.posts}</span>
        <span class="chart-bar-label">${d.day}</span>
      </div>
    `;
  }).join('');
}

function getReportsHTML() {
  return `
    <div class="report-summary">
      <div class="summary-card">
        <div class="summary-icon">üìÖ</div>
        <div class="summary-value" id="postsToday">0</div>
        <div class="summary-label">Posts Today</div>
      </div>
      <div class="summary-card">
        <div class="summary-icon">üìÜ</div>
        <div class="summary-value" id="postsWeek">0</div>
        <div class="summary-label">This Week</div>
      </div>
      <div class="summary-card">
        <div class="summary-icon">üìä</div>
        <div class="summary-value" id="postsMonth">0</div>
        <div class="summary-label">This Month</div>
      </div>
      <div class="summary-card">
        <div class="summary-icon">üèÜ</div>
        <div class="summary-value" id="postsAllTime">0</div>
        <div class="summary-label">All Time</div>
      </div>
    </div>
    
    <div class="report-section">
      <h3>‚ö° Performance</h3>
      <div class="metric-row">
        <span class="metric-label">Avg. Posts/Day</span>
        <span class="metric-value" id="avgPostsDay">0</span>
      </div>
      <div class="metric-row">
        <span class="metric-label">Avg. Time per Post</span>
        <span class="metric-value" id="avgTimePost">0s</span>
      </div>
      <div class="metric-row">
        <span class="metric-label">Time Saved (est.)</span>
        <span class="metric-value highlight" id="timeSaved">0 hrs</span>
      </div>
    </div>
    
    <div class="report-section">
      <h3>‚è±Ô∏è Time Spent</h3>
      <div class="metric-row">
        <span class="metric-label">Today</span>
        <span class="metric-value" id="timeToday">0 min</span>
      </div>
      <div class="metric-row">
        <span class="metric-label">This Week</span>
        <span class="metric-value" id="timeWeek">0 min</span>
      </div>
      <div class="metric-row">
        <span class="metric-label">This Month</span>
        <span class="metric-value" id="timeMonth">0 min</span>
      </div>
    </div>
    
    <div class="report-section">
      <h3>üìà Last 7 Days</h3>
      <div class="chart-container" id="weeklyChart"></div>
    </div>
    
    <div class="report-section roi-section">
      <h3>üí∞ Your ROI</h3>
      <p class="roi-description">Based on 14 min saved per post @ $30/hr</p>
      <div class="roi-value" id="roiValue">$0</div>
      <div class="roi-label">estimated value this month</div>
    </div>
    
    <button class="btn-refresh" onclick="loadReports()">üîÑ Refresh Stats</button>
  `;
}

// Load reports when tab is clicked
document.querySelector('[data-tab="reports"]')?.addEventListener('click', loadReports);
</script>
